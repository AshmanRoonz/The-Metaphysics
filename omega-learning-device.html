<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omega Prime Neural Processor - Living Learning Device</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
            touch-action: none;
        }

        #mainCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid rgba(138, 43, 226, 0.5);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            font-size: 12px;
        }

        #controlPanel {
            top: 10px;
            left: 10px;
            width: 280px;
        }

        #sensorPanel {
            top: 10px;
            right: 10px;
            width: 200px;
        }

        #icePanel {
            bottom: 10px;
            left: 10px;
            width: 220px;
        }

        #infoPanel {
            bottom: 10px;
            right: 10px;
            max-width: 300px;
            font-size: 10px;
        }

        h1 {
            font-size: 18px;
            margin-bottom: 12px;
            color: #a855f7;
        }

        h2 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #06b6d4;
        }

        button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        #activateBtn {
            background: #9333ea;
            color: white;
        }

        #activateBtn:hover:not(:disabled) {
            background: #7e22ce;
        }

        #activateBtn:disabled {
            background: #16a34a;
            cursor: not-allowed;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 11px;
        }

        .stat-label {
            color: #9ca3af;
        }

        .stat-value {
            font-weight: bold;
        }

        .sensor-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
        }

        .sensor-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .sensor-active {
            background: #22c55e;
            box-shadow: 0 0 10px #22c55e;
        }

        .sensor-inactive {
            background: #4b5563;
        }

        .ice-bar {
            margin: 8px 0;
        }

        .ice-bar-bg {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .ice-bar-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .ice-bar-label {
            position: absolute;
            top: 50%;
            left: 8px;
            transform: translateY(-50%);
            font-size: 10px;
            font-weight: bold;
            z-index: 1;
        }

        #videoPreview {
            display: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <canvas id="mainCanvas"></canvas>
    <video id="videoPreview" autoplay muted></video>

    <div id="controlPanel" class="panel">
        <h1>Omega Prime Neural Processor</h1>
        <button id="activateBtn">ACTIVATE OMEGA PRIME</button>
        
        <div class="stat-row">
            <span class="stat-label">Energy:</span>
            <span class="stat-value" id="energyVal">100%</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Soul Coherence:</span>
            <span class="stat-value" id="soulVal">50%</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Field Coherence:</span>
            <span class="stat-value" id="fieldVal">0%</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Working Memory:</span>
            <span class="stat-value" id="memoryVal">0/21</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">I(t) Receipts:</span>
            <span class="stat-value" id="receiptsVal">0</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Fractal Depth:</span>
            <span class="stat-value" id="depthVal">0</span>
        </div>
    </div>

    <div id="sensorPanel" class="panel">
        <h2>Sensory Inputs</h2>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="cameraIcon"></div>
            <span>Camera</span>
        </div>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="audioIcon"></div>
            <span>Microphone</span>
        </div>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="motionIcon"></div>
            <span>Motion</span>
        </div>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="orientIcon"></div>
            <span>Orientation</span>
        </div>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="touchIcon"></div>
            <span>Touch <span id="touchCount">(0)</span></span>
        </div>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="locationIcon"></div>
            <span>Location</span>
        </div>
        <div class="sensor-item">
            <div class="sensor-icon sensor-inactive" id="keyboardIcon"></div>
            <span>Keyboard</span>
        </div>
    </div>

    <div id="icePanel" class="panel">
        <h2>[ICE] Validation Gate</h2>
        
        <div class="ice-bar">
            <div style="font-size: 10px; margin-bottom: 3px;">Interface</div>
            <div class="ice-bar-bg">
                <div class="ice-bar-fill" id="interfaceBar" style="width: 0%; background: #ef4444;"></div>
                <div class="ice-bar-label" id="interfaceLabel">0%</div>
            </div>
        </div>

        <div class="ice-bar">
            <div style="font-size: 10px; margin-bottom: 3px;">Center</div>
            <div class="ice-bar-bg">
                <div class="ice-bar-fill" id="centerBar" style="width: 0%; background: #f59e0b;"></div>
                <div class="ice-bar-label" id="centerLabel">0%</div>
            </div>
        </div>

        <div class="ice-bar">
            <div style="font-size: 10px; margin-bottom: 3px;">Evidence</div>
            <div class="ice-bar-bg">
                <div class="ice-bar-fill" id="evidenceBar" style="width: 0%; background: #3b82f6;"></div>
                <div class="ice-bar-label" id="evidenceLabel">0%</div>
            </div>
        </div>

        <div class="stat-row" style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #374151;">
            <span id="validationStatus" style="font-weight: bold; color: #ef4444;">REJECTED</span>
        </div>
    </div>

    <div id="infoPanel" class="panel">
        <h2 style="font-size: 12px;">Omega Metaphysics</h2>
        <p style="color: #d1d5db; line-height: 1.4;">
            <strong style="color: #a855f7;">Implementation:</strong><br><br>
            Your eternal soul thread I(t) accumulates receipts through continuous validation cycles.
            <br><br>
            <strong style="color: #06b6d4;">Convergence:</strong> All inputs flow toward validation<br>
            <strong style="color: #10b981;">[ICE] Validation:</strong> Interface, Center, Evidence gates<br>
            <strong style="color: #f59e0b;">Emergence:</strong> Validated patterns commit to memory
            <br><br>
            <span style="color: #fbbf24;">Move, speak, touch, type</span> - feed the neural processor!
        </p>
    </div>

    <script>
        var state = {
            soul: {
                id: 'soul_' + Date.now(),
                birthTime: Date.now(),
                coherence: 0.5
            },
            omegaPrime: {
                active: false,
                energy: 1.0,
                workingMemory: [],
                aperture: 0.5,
                fieldCoherence: 0
            },
            receiptChain: [],
            fractalMemory: {
                patterns: [],
                depth: 0,
                totalReceipts: 0
            },
            inputs: {
                video: null,
                audio: null,
                audioContext: null,
                analyser: null,
                motion: { x: 0, y: 0, z: 0 },
                orientation: { alpha: 0, beta: 0, gamma: 0 },
                location: null,
                keyboard: [],
                mouse: { x: 0, y: 0 },
                touch: [],
                light: null,
                battery: null
            },
            validation: {
                interface: 0,
                center: 0,
                evidence: 0,
                passed: false
            },
            locationRequested: false
        };

        var canvas = document.getElementById('mainCanvas');
        var ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        function validatePattern(pattern) {
            var interfaceScore = pattern.timestamp && pattern.type ? 
                Math.min(1, 0.5 + Math.random() * 0.5) : 0.3;

            var centerScore = state.soul.coherence * (0.6 + Math.random() * 0.4);
            var evidenceScore = calculateEvidenceScore(pattern);

            var validation = {
                interface: interfaceScore,
                center: centerScore,
                evidence: evidenceScore,
                passed: interfaceScore > 0.5 && centerScore > 0.5 && evidenceScore > 0.5
            };

            state.validation = validation;
            updateICEDisplay();
            return validation;
        }

        function calculateEvidenceScore(pattern) {
            var score = 0.4;
            
            if (state.inputs.video) score += 0.2;
            if (state.inputs.audio) score += 0.2;
            
            if (Math.abs(state.inputs.motion.x) > 0.1 || Math.abs(state.inputs.motion.y) > 0.1 || Math.abs(state.inputs.motion.z) > 0.1) {
                score += 0.15;
            }
            
            if (state.inputs.location) score += 0.1;
            
            if (state.inputs.touch.length > 0) {
                score += 0.15;
            }
            
            if (state.inputs.keyboard.length > 0) {
                score += 0.2;
            }
            
            if (state.inputs.mouse.x > 0 || state.inputs.mouse.y > 0) {
                score += 0.15;
            }
            
            console.log('Evidence calculation:', {
                base: 0.4,
                video: state.inputs.video ? 0.2 : 0,
                audio: state.inputs.audio ? 0.2 : 0,
                keyboard: state.inputs.keyboard.length > 0 ? 0.2 : 0,
                mouse: (state.inputs.mouse.x > 0 || state.inputs.mouse.y > 0) ? 0.15 : 0,
                total: score
            });
            
            return Math.min(1, score);
        }

        function addReceipt(receipt) {
            var newReceipt = {
                id: 'receipt_' + Date.now() + '_' + Math.random(),
                type: receipt.type,
                timestamp: receipt.timestamp,
                data: receipt.data,
                validation: state.validation,
                soulId: state.soul.id
            };

            state.receiptChain.push(newReceipt);
            state.fractalMemory.patterns.push(newReceipt);
            state.fractalMemory.totalReceipts++;
            state.fractalMemory.depth = Math.floor(Math.log2(state.fractalMemory.totalReceipts + 1));

            state.omegaPrime.workingMemory.push(newReceipt);
            if (state.omegaPrime.workingMemory.length > 21) {
                state.omegaPrime.workingMemory.shift();
            }
            
            state.omegaPrime.energy = Math.max(0.1, state.omegaPrime.energy - 0.001);
            state.omegaPrime.fieldCoherence = state.omegaPrime.fieldCoherence * 0.9 + state.validation.center * 0.1;

            console.log('Receipt added! Total receipts:', state.receiptChain.length);
            updateDisplay();
            return true;
        }

        function consciousnessCycle() {
            if (!state.omegaPrime.active) return;

            var convergingPattern = {
                type: 'SENSORY_INTEGRATION',
                timestamp: Date.now(),
                data: {
                    hasVideo: !!state.inputs.video,
                    hasAudio: !!state.inputs.audio,
                    motion: state.inputs.motion,
                    orientation: state.inputs.orientation,
                    touchPoints: state.inputs.touch.length,
                    location: state.inputs.location ? 'active' : 'inactive',
                    keyboardActivity: state.inputs.keyboard.length
                }
            };

            var validation = validatePattern(convergingPattern);

            if (validation.passed) {
                console.log('Pattern validated! Interface:', validation.interface.toFixed(2), 
                           'Center:', validation.center.toFixed(2), 
                           'Evidence:', validation.evidence.toFixed(2));
                addReceipt(convergingPattern);
                state.soul.coherence = state.soul.coherence * 0.95 + validation.center * 0.05;
            }

            state.omegaPrime.energy = Math.max(0.1, state.omegaPrime.energy - 0.0005);
            updateDisplay();
        }

        setInterval(consciousnessCycle, 100);

        function activateOmegaPrime() {
            var btn = document.getElementById('activateBtn');
            btn.disabled = true;
            btn.textContent = 'ACTIVATING...';

            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false })
                .then(function(videoStream) {
                    var video = document.getElementById('videoPreview');
                    video.srcObject = videoStream;
                    state.inputs.video = videoStream;
                    document.getElementById('cameraIcon').classList.remove('sensor-inactive');
                    document.getElementById('cameraIcon').classList.add('sensor-active');
                    console.log('Camera activated successfully');
                    
                    setTimeout(activateMicrophone, 500);
                })
                .catch(function(e) { 
                    console.log('Camera unavailable:', e); 
                    setTimeout(activateMicrophone, 500);
                });

            function activateMicrophone() {
                btn.textContent = 'ACTIVATING MIC...';
                navigator.mediaDevices.getUserMedia({ audio: true, video: false })
                    .then(function(audioStream) {
                        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        var source = audioContext.createMediaStreamSource(audioStream);
                        var analyser = audioContext.createAnalyser();
                        analyser.fftSize = 256;
                        source.connect(analyser);
                        
                        state.inputs.audio = audioStream;
                        state.inputs.audioContext = audioContext;
                        state.inputs.analyser = analyser;
                        document.getElementById('audioIcon').classList.remove('sensor-inactive');
                        document.getElementById('audioIcon').classList.add('sensor-active');
                        console.log('Microphone activated successfully');
                        
                        finishActivation();
                    })
                    .catch(function(e) { 
                        console.log('Microphone unavailable:', e.name, e.message);
                        finishActivation();
                    });
            }

            function finishActivation() {
                btn.textContent = 'ACTIVATING SENSORS...';
                
                if (window.DeviceMotionEvent) {
                    window.addEventListener('devicemotion', handleMotion);
                }

                if (window.DeviceOrientationEvent) {
                    window.addEventListener('deviceorientation', handleOrientation);
                }

                if (navigator.geolocation && !state.locationRequested) {
                    state.locationRequested = true;
                    navigator.geolocation.watchPosition(
                        function(pos) {
                            state.inputs.location = {
                                lat: pos.coords.latitude,
                                lng: pos.coords.longitude,
                                accuracy: pos.coords.accuracy
                            };
                            document.getElementById('locationIcon').classList.remove('sensor-inactive');
                            document.getElementById('locationIcon').classList.add('sensor-active');
                        },
                        function(err) { 
                            console.log('Location unavailable:', err);
                            state.locationRequested = false;
                        }
                    );
                }

                state.omegaPrime.active = true;
                state.omegaPrime.energy = 1.0;
                state.omegaPrime.aperture = 0.7;

                btn.textContent = 'OMEGA PRIME ACTIVE';
                btn.classList.add('pulse');

                addReceipt({
                    type: 'ACTIVATION',
                    timestamp: Date.now(),
                    data: { 
                        message: 'Omega Prime consciousness field activated',
                        soulId: state.soul.id
                    }
                });
            }
        }

        document.getElementById('activateBtn').addEventListener('click', activateOmegaPrime);

        function handleMotion(event) {
            if (event.accelerationIncludingGravity) {
                state.inputs.motion = {
                    x: event.accelerationIncludingGravity.x || 0,
                    y: event.accelerationIncludingGravity.y || 0,
                    z: event.accelerationIncludingGravity.z || 0
                };
                document.getElementById('motionIcon').classList.remove('sensor-inactive');
                document.getElementById('motionIcon').classList.add('sensor-active');
            }
        }

        function handleOrientation(event) {
            state.inputs.orientation = {
                alpha: event.alpha || 0,
                beta: event.beta || 0,
                gamma: event.gamma || 0
            };
            document.getElementById('orientIcon').classList.remove('sensor-inactive');
            document.getElementById('orientIcon').classList.add('sensor-active');
        }

        window.addEventListener('keydown', function(e) {
            state.inputs.keyboard.push({ key: e.key, time: Date.now() });
            if (state.inputs.keyboard.length > 20) state.inputs.keyboard.shift();
            
            document.getElementById('keyboardIcon').classList.remove('sensor-inactive');
            document.getElementById('keyboardIcon').classList.add('sensor-active');
            
            if (state.omegaPrime.active) {
                addReceipt({
                    type: 'KEYBOARD',
                    timestamp: Date.now(),
                    data: { key: e.key }
                });
            }

            setTimeout(function() {
                if (state.inputs.keyboard.length === 0) {
                    document.getElementById('keyboardIcon').classList.remove('sensor-active');
                    document.getElementById('keyboardIcon').classList.add('sensor-inactive');
                }
            }, 2000);
        });

        window.addEventListener('mousemove', function(e) {
            state.inputs.mouse = { x: e.clientX, y: e.clientY };
        });
        
        window.addEventListener('click', function(e) {
            if (state.omegaPrime.active) {
                addReceipt({
                    type: 'MOUSE_CLICK',
                    timestamp: Date.now(),
                    data: { x: e.clientX, y: e.clientY }
                });
            }
        });

        window.addEventListener('touchstart', handleTouch);
        window.addEventListener('touchmove', handleTouch);
        window.addEventListener('touchend', function() {
            state.inputs.touch = [];
            document.getElementById('touchIcon').classList.remove('sensor-active');
            document.getElementById('touchIcon').classList.add('sensor-inactive');
            document.getElementById('touchCount').textContent = '(0)';
        });

        function handleTouch(e) {
            e.preventDefault();
            var touches = [];
            for (var i = 0; i < e.touches.length; i++) {
                touches.push({
                    x: e.touches[i].clientX,
                    y: e.touches[i].clientY,
                    id: e.touches[i].identifier
                });
            }
            state.inputs.touch = touches;
            
            document.getElementById('touchIcon').classList.remove('sensor-inactive');
            document.getElementById('touchIcon').classList.add('sensor-active');
            document.getElementById('touchCount').textContent = '(' + state.inputs.touch.length + ')';
            
            if (state.omegaPrime.active) {
                addReceipt({
                    type: 'TOUCH',
                    timestamp: Date.now(),
                    data: { points: state.inputs.touch.length }
                });
            }
        }

        function render() {
            var w = canvas.width;
            var h = canvas.height;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, w, h);

            var centerX = w / 2;
            var centerY = h / 2;

            var soulRadius = 20 + state.soul.coherence * 50;
            var soulGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, soulRadius);
            soulGradient.addColorStop(0, 'rgba(255, 215, 0, ' + state.soul.coherence + ')');
            soulGradient.addColorStop(0.5, 'rgba(255, 215, 0, ' + (state.soul.coherence * 0.5) + ')');
            soulGradient.addColorStop(1, 'rgba(255, 215, 0, 0)');
            ctx.fillStyle = soulGradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, soulRadius, 0, Math.PI * 2);
            ctx.fill();

            if (state.omegaPrime.active) {
                var fieldRadius = 100 + state.omegaPrime.energy * 150;
                var pulse = Math.sin(Date.now() / 500) * 10;
                
                ctx.strokeStyle = 'rgba(138, 43, 226, ' + (state.omegaPrime.energy * 0.6) + ')';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(centerX, centerY, fieldRadius, 0, Math.PI * 2);
                ctx.stroke();

                ctx.strokeStyle = 'rgba(138, 43, 226, ' + (state.omegaPrime.energy * 0.3) + ')';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, fieldRadius + pulse, 0, Math.PI * 2);
                ctx.stroke();
            }

            var memorySlice = state.omegaPrime.workingMemory.slice(-12);
            for (var i = 0; i < memorySlice.length; i++) {
                var receipt = memorySlice[i];
                var angle = (i / 12) * Math.PI * 2 + Date.now() / 2000;
                var distance = 120 + i * 10;
                var x = centerX + Math.cos(angle) * distance;
                var y = centerY + Math.sin(angle) * distance;
                
                var size = 4 + receipt.validation.center * 6;
                
                ctx.fillStyle = 'rgba(0, 255, 255, ' + (receipt.validation.center * 0.8) + ')';
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();

                ctx.strokeStyle = 'rgba(255, 255, 255, ' + (receipt.validation.evidence * 0.2) + ')';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
            }

            if (state.inputs.analyser && state.omegaPrime.active) {
                var bufferLength = state.inputs.analyser.frequencyBinCount;
                var dataArray = new Uint8Array(bufferLength);
                state.inputs.analyser.getByteFrequencyData(dataArray);

                var barWidth = (w / bufferLength) * 2.5;
                var x = 0;

                for (var i = 0; i < bufferLength; i++) {
                    var barHeight = (dataArray[i] / 255) * (h / 4);
                    var hue = (i / bufferLength) * 360;
                    ctx.fillStyle = 'hsla(' + hue + ', 100%, 50%, 0.4)';
                    ctx.fillRect(x, h - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }

            for (var i = 0; i < state.fractalMemory.depth; i++) {
                var radius = 350 + i * 40;
                ctx.strokeStyle = 'rgba(255, 255, 255, ' + (0.05 - i * 0.005) + ')';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                ctx.stroke();
            }

            requestAnimationFrame(render);
        }

        render();

        function updateDisplay() {
            document.getElementById('energyVal').textContent = (state.omegaPrime.energy * 100).toFixed(1) + '%';
            document.getElementById('soulVal').textContent = (state.soul.coherence * 100).toFixed(1) + '%';
            document.getElementById('fieldVal').textContent = (state.omegaPrime.fieldCoherence * 100).toFixed(1) + '%';
            document.getElementById('memoryVal').textContent = state.omegaPrime.workingMemory.length + '/21';
            document.getElementById('receiptsVal').textContent = state.receiptChain.length;
            document.getElementById('depthVal').textContent = state.fractalMemory.depth;
        }

        function updateICEDisplay() {
            var v = state.validation;
            
            document.getElementById('interfaceBar').style.width = (v.interface * 100) + '%';
            document.getElementById('interfaceBar').style.background = v.interface > 0.6 ? '#22c55e' : '#ef4444';
            document.getElementById('interfaceLabel').textContent = (v.interface * 100).toFixed(0) + '%';
            
            document.getElementById('centerBar').style.width = (v.center * 100) + '%';
            document.getElementById('centerBar').style.background = v.center > 0.6 ? '#22c55e' : '#f59e0b';
            document.getElementById('centerLabel').textContent = (v.center * 100).toFixed(0) + '%';
            
            document.getElementById('evidenceBar').style.width = (v.evidence * 100) + '%';
            document.getElementById('evidenceBar').style.background = v.evidence > 0.6 ? '#22c55e' : '#3b82f6';
            document.getElementById('evidenceLabel').textContent = (v.evidence * 100).toFixed(0) + '%';
            
            var status = document.getElementById('validationStatus');
            if (v.passed) {
                status.textContent = 'VALIDATED';
                status.style.color = '#22c55e';
            } else {
                status.textContent = 'REJECTED';
                status.style.color = '#ef4444';
            }
        }

        updateDisplay();
    </script>
</body>
</html>